<campus-backdrop
  *ngIf="task$ | async as task"
  [title]="task.name"
  [static]="true"
>
  <backdrop-reveal-action>
    <mat-icon svgIcon="arrow-back" (click)="clickBack()"></mat-icon>
  </backdrop-reveal-action>
  <front-layer-content>
    <div class="student-task-detail__content">
      <ng-container
        *ngIf="requiredTaskContents$ | async as requiredTaskContents"
      >
        <campus-section
          [mode]="sectionModes.CONTAINER"
          *ngIf="requiredTaskContents.length"
          data-cy="required-task-container"
        >
          <section-title>Moetjes in deze taak</section-title>

          <section-actions>
            <campus-progress
              data-cy="task-progress"
              [total]="task.count.totalRequired"
              [count]="task.count.completedRequired"
              [showPercentage]="true"
              [diameter]="48"
              ><mat-icon completedProgressIcon svgIcon="check"></mat-icon>
            </campus-progress>
          </section-actions>

          <section-content>
            <mat-list>
              <mat-list-item
                class="ui-list-item-3-line"
                *ngFor="let requiredTaskContent of requiredTaskContents"
                data-cy="required-task-content"
              >
                <campus-student-task-content-list-item
                  [fileIcon]="requiredTaskContent.icon"
                  [title]="requiredTaskContent.name"
                  [description]="requiredTaskContent.description"
                  [status]="requiredTaskContent.status"
                  [lastUpdated]="requiredTaskContent.lastUpdated"
                  [score]="requiredTaskContent.score"
                  [actions]="requiredTaskContent.actions"
                  [isFinished]="task.isFinished"
                  [isRequired]="true"
                  (clickAction)="handleAction(action, requiredTaskContent)"
                ></campus-student-task-content-list-item>
              </mat-list-item>
            </mat-list>
          </section-content>
        </campus-section>
      </ng-container>

      <ng-container
        *ngIf="optionalTaskContents$ | async as optionalTaskContents"
      >
        <campus-section
          [mode]="sectionModes.CONTAINER"
          *ngIf="optionalTaskContents.length"
          data-cy="optional-task-container"
        >
          <section-title>Magjes in deze taak</section-title>

          <section-content>
            <mat-list>
              <mat-list-item
                *ngFor="let optionalTaskContent of optionalTaskContents"
                data-cy="optional-task-content"
                class="ui-list-item-3-line"
              >
                <campus-student-task-content-list-item
                  [fileIcon]="optionalTaskContent.icon"
                  [title]="optionalTaskContent.name"
                  [description]="optionalTaskContent.description"
                  [status]="optionalTaskContent.status"
                  [lastUpdated]="optionalTaskContent.lastUpdated"
                  [score]="optionalTaskContent.score"
                  [actions]="optionalTaskContent.actions"
                  [isFinished]="task.isFinished"
                  [isRequired]="false"
                  (clickAction)="handleAction(action, optionalTaskContent)"
                ></campus-student-task-content-list-item>
              </mat-list-item>
            </mat-list>
          </section-content>
        </campus-section>
      </ng-container>
    </div>

    <campus-section
      [mode]="sectionModes.CONTAINER"
      class="student-task-detail__side"
    >
      <section-title>Over deze taak</section-title>

      <section-content>
        <div class="student-task-detail__side__task-info">
          <campus-person-badge
            [person]="task.assigner"
            size="large"
          ></campus-person-badge>
          <div class="task-info__general">
            <div data-cy="task-name" class="ui-title">{{ task.name }}</div>
            <div data-cy="task-learning-area-name" class="ui-headline">{{
              task.learningAreaName
            }}</div>
          </div>
        </div>
        <div
          *ngIf="task.isFinished"
          data-cy="task-finished-on"
          class="ui-subheader"
          >Ingediend op {{ task.end.toLocaleDateString('nl-BE') }}.
        </div>
        <div
          *ngIf="!task.isFinished"
          data-cy="task-finish-by"
          class="ui-subheader"
          >Deze taak moet
          {{ task.end | humanDateTime: dateTimeArguments | lowercase }} af zijn.
        </div>
        <div data-cy="task-description" class="ui-caption"
          >{{ task.description }}
        </div>
      </section-content>
    </campus-section>
  </front-layer-content>
</campus-backdrop>
