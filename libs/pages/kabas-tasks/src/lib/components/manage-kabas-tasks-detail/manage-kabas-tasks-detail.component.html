<campus-page-bar *ngIf="task$ | async as task">
  <ng-container *ngIf="selectedContents$ | async as selectedContents">
    <ng-container *ngIf="selectedContents.length === 0; else contentSelected">
      <campus-button
        class="shared-header__contextual__button smallIcon"
        iconClass=""
        ><span>Lesmateriaal toevoegen</span></campus-button
      >
      <campus-button
        *ngIf="!task.isPaperTask"
        class="shared-header__contextual__button smallIcon"
        iconClass="results"
        ><span>Resultaten bekijken</span></campus-button
      >
      <campus-button
        class="shared-header__contextual__button smallIcon"
        iconClass=""
        ><span>Doelenmatrix</span></campus-button
      >
      <campus-button
        *ngIf="task.isPaperTask"
        class="shared-header__contextual__button smallIcon"
        iconClass=""
        ><span>Print</span></campus-button
      >
    </ng-container>

    <ng-template #contentSelected>
      <campus-button
        *ngIf="!task.isPaperTask && selectedContents.length === 1"
        class="shared-header__contextual__button smallIcon"
        iconClass=""
        ><span>Preview</span></campus-button
      >
      <campus-button
        *ngIf="task.isPaperTask"
        class="shared-header__contextual__button smallIcon"
        iconClass=""
        ><span>Print</span></campus-button
      >
      <campus-button
        class="shared-header__contextual__button smallIcon"
        iconClass="delete"
        ><span>Verwijderen</span></campus-button
      >
    </ng-template>
  </ng-container>
</campus-page-bar>

<ng-template #noTask>Deze taak is niet beschikbaar.</ng-template>
<campus-side-sheet
  #taskSidesheet
  *ngIf="task$ | async as task; else noTask"
  [isOpenOnInit]="true"
>
  <campus-side-sheet-header>
    <ng-container [ngSwitch]="(selectedContents$ | async)?.length">
      <ng-container *ngSwitchCase="0">Over deze taak:</ng-container>
      <ng-container *ngSwitchCase="1">Over deze oefening:</ng-container>
      <ng-container *ngSwitchDefault>Over deze oefeningen:</ng-container>
    </ng-container>
  </campus-side-sheet-header>

  <campus-side-sheet-body>
    <div
      *ngIf="selectedContents$ | async as selectedContents"
      class="manage-kabas-tasks-detail__info"
    >
      <ng-container *ngIf="selectedContents.length === 0; else contentDetails">
        <input type="text" placeholder="Titel" [value]="task.name" />
        <textarea placeholder="Omschrijving">{{ task.description }}</textarea>
        <p>{{ task.learningArea.name }}</p>
        <ng-container *ngIf="task.isPaperTask; else showDates">
          <campus-button>Print</campus-button>
        </ng-container>
        <ng-template #showDates>
          <p *ngIf="task.startDate"
            >{{ task.startDate | humanDateTime }} -
            {{ task.endDate | humanDateTime }}</p
          >
        </ng-template>

        <div class="manage-kabas-tasks-detail__info__container">
          <div>
            <campus-button
              class="manage-kabas-tasks-detail__info__add-assignees"
              >+</campus-button
            >
            leerlingen toevoegen voor deze taak:
          </div>
          <div>
            <span
              *ngFor="let assignee of task.assignees"
              class="manage-kabas-tasks-detail__info__assignee"
              [class.classgroup]="
                assignee.type === assigneeTypesEnum.CLASSGROUP
              "
              [class.group]="assignee.type === assigneeTypesEnum.GROUP"
              [class.student]="assignee.type === assigneeTypesEnum.STUDENT"
              >{{ assignee.label }}</span
            >
          </div>
        </div>

        <campus-button primary>+ oefening toevoegen</campus-button>
        <campus-button danger>verwijder taak</campus-button>
      </ng-container>

      <ng-template #contentDetails>
        <div
          class="manage-kabas-tasks-detail__info__container"
          *ngFor="let selectedContent of selectedContents"
        >
          <ng-container
            *ngIf="selectedContent.publishedEduContentMetadata as metadata"
          >
            <h2>{{ metadata.title }}</h2>
            <p>{{ metadata.description }}</p>
            <div>{{ metadata.learningArea.name }}</div>
            <div *ngIf="metadata.methods" class="list-split">
              <span *ngFor="let method of metadata.methods">{{
                method.name
              }}</span>
            </div>
            <campus-button>preview</campus-button>
          </ng-container>
        </div>

        <div
          *ngIf="!task.isPaperTask"
          class="manage-kabas-tasks-detail__info__container"
        >
          <mat-radio-group>
            <mat-radio-button [value]="true">Moetje</mat-radio-button>
            <br /><mat-radio-button [value]="false">Magje</mat-radio-button>
          </mat-radio-group>
          <campus-button>opslaan</campus-button>
        </div>

        <campus-button danger>verwijder oefeningen</campus-button>
      </ng-template>
    </div>
  </campus-side-sheet-body>

  <campus-side-sheet-page>
    <div class="manage-kabas-tasks-detail"
      ><div class="manage-kabas-tasks-detail__container">
        <div class="manage-kabas-tasks-detail__filterbar">
          <campus-search-term
            placeholder="Filter op titel"
            [autoComplete]="false"
            [emitOnTextChange]="true"
          ></campus-search-term>

          <div
            *ngIf="!task.isPaperTask"
            class="manage-kabas-tasks-detail__moetje-toggle"
          >
            Moetje
            <mat-slide-toggle color="primary"> </mat-slide-toggle>
            Magje
          </div>

          <campus-button-toggle-filter
            [multiple]="true"
            [filterCriteria]="diaboloPhaseFilter"
          >
          </campus-button-toggle-filter>

          <campus-button
            class="manage-kabas-tasks-detail__reset-filters"
            iconClass="reset-filters"
          ></campus-button>
        </div>

        <mat-selection-list
          #taskContent
          class="manage-kabas-tasks-detail__list"
          [class.mat-selection-list--has-selection]="
            !taskContent.selectedOptions.isEmpty()
          "
          (selectionChange)="onSelectionChange()"
        >
          <mat-list-item
            class="manage-kabas-tasks-detail__list__primary-action"
          >
            <mat-icon svgIcon="add"></mat-icon>
            Lesmateriaal toevoegen aan deze taak
          </mat-list-item>
          <ng-container *ngIf="task.eduContents.length; else noResults">
            <mat-list-option
              #option
              *ngFor="let eduContent of task.eduContents"
              checkboxPosition="before"
              [class.mat-list-option--selected]="option.selected"
              [value]="eduContent"
            >
              {{ eduContent.publishedEduContentMetadata.title }}
            </mat-list-option>
          </ng-container>
        </mat-selection-list>

        <ng-template #noResults>
          <p>De toegepaste filter bevat geen resultaten.</p>
        </ng-template>
      </div>
    </div>
  </campus-side-sheet-page>
</campus-side-sheet>
