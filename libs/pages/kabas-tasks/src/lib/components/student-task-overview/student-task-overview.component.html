<campus-backdrop [title]="'Mijn taken'" [static]="true">
  <backdrop-reveal-action>
    <mat-icon svgIcon="tasks"></mat-icon>
  </backdrop-reveal-action>
  <front-layer-content class="student-task-overview">
    <campus-section
      [mode]="sectionModes.CONTAINER"
      class="student-task-overview__main"
    >
      <section-title>
        {{ sectionTitle$ | async }}
        <ng-container *ngIf="(taskCount$ | async) === 0">
          <campus-button
            bordered
            *ngIf="showFinishedTasks$ | async; else showActiveTasks"
            (click)="showFinishedTasks$.next(false)"
            data-cy="sto-filter-active"
            >Actieve taken</campus-button
          >
        </ng-container>
        <ng-template #showActiveTasks>
          <campus-button
            bordered
            (click)="showFinishedTasks$.next(true)"
            data-cy="sto-filter-finished"
            >Afgewerkte taken</campus-button
          >
        </ng-template>
      </section-title>
      <section-content>
        <campus-empty-state
          *ngIf="emptyStateData$ | async as emptyStateData; else filledState"
          [title]="emptyStateData.title"
          [description]="emptyStateData.description"
          [ctaLabel]="emptyStateData.ctaLabel"
          [svgIcon]="emptyStateData.svgIcon"
          (clickCta)="emptyStateClick(emptyStateData.ctaLink)"
          data-cy="sto-empty-state"
        ></campus-empty-state>
        <ng-template #filledState>
          <mat-list *ngFor="let section of taskListSections$ | async">
            <h1 matSubheader [id]="section.learningAreaId">{{
              section.label
            }}</h1>
            <mat-list-item
              *ngFor="let studentTask of section.items"
              class="ui-list-item-3-line"
            >
              <!-- TODO: add actions -->
              <campus-student-task-list-item
                [title]="studentTask.name"
                [description]="studentTask.description"
                [learningAreaName]="studentTask.learningAreaName"
                [dateLabel]="studentTask.dateLabel"
                [completedRequired]="studentTask.count.completedRequired"
                [totalRequired]="studentTask.count.totalRequired"
                [urgent]="studentTask.isUrgent"
                [finished]="studentTask.isFinished"
                [actions]="[]"
              >
              </campus-student-task-list-item>
            </mat-list-item>
            <mat-list-item></mat-list-item>
          </mat-list>
        </ng-template>
      </section-content>
    </campus-section>
    <campus-section
      [mode]="sectionModes.CONTAINER"
      class="student-task-overview__aside"
      [class.student-task-overview__aside--hidden]="(taskCount$ | async) === 0"
    >
      <section-content>
        <campus-section [mode]="sectionModes.STATIC">
          <section-content class="student-task-overview__aside__actions">
            <div>
              <campus-button
                inline
                *ngIf="showFinishedTasks$ | async; else actionForActiveTasks"
                (click)="showFinishedTasks$.next(false)"
                data-cy="sto-filter-active"
                ><mat-icon svgIcon="task:active"></mat-icon>Toon actieve
                taken</campus-button
              >
            </div>
            <ng-template #actionForActiveTasks>
              <campus-button
                inline
                (click)="showFinishedTasks$.next(true)"
                data-cy="sto-filter-finished"
                ><mat-icon svgIcon="task:finished"></mat-icon>Toon afgewerkte
                taken</campus-button
              >
            </ng-template>

            <div>
              <campus-button
                inline
                *ngIf="
                  isGroupedByDate$ | async;
                  else actionForGroupedByLearningArea
                "
                (click)="isGroupedByDate$.next(false)"
                data-cy="sto-sort-by-learning-area"
                ><mat-icon svgIcon="sort:learning-area"></mat-icon>Groepeer per
                vak</campus-button
              >
            </div>
            <ng-template #actionForGroupedByLearningArea>
              <campus-button
                inline
                (click)="isGroupedByDate$.next(true)"
                data-cy="sto-sort-by-date"
                ><mat-icon svgIcon="sort:date"></mat-icon>Sorteer op
                datum</campus-button
              >
            </ng-template>
            <div *ngIf="!isGroupedByDate$.value">
              <hr />
              <div *ngFor="let taskInfo of tasksByLearningAreaInfo$ | async"
                ><campus-button
                  inline
                  (click)="scrollTo(taskInfo.learningAreaId)"
                  data-cy="sto-info-by-learning-area"
                >
                  {{ taskInfo | taskInfoByLearningArea }}</campus-button
                ></div
              >
            </div>
          </section-content>
        </campus-section>
      </section-content>
    </campus-section>
  </front-layer-content>
</campus-backdrop>
