<div *ngIf="currentUser$ | async as user" class="campus-page">
  <campus-page-header
    [title]="'Instellingen'"
    [subtitle]="'Mijn profielfoto'"
    [iconClass]="'avatar'"
  >
  </campus-page-header>
  <campus-info-panel
    [titleText]="'Profielfoto aanpassen'"
    [titleIcon]="'account'"
    [titleRightRouterLink]="['/settings']"
  >
    <mat-icon
      title__right
      class="info-panel__title--left__icon"
      [svgIcon]="'arrow-back'"
    ></mat-icon>
    <div title__right>Instellingen</div>
    <form
      class="pages-settings-profile-avatar"
      [class.compact]="isSmallScreen$ | async"
    >
      <div>
        <ng-template #selectImg>
          <form
            class="file-upload"
            [class.hover]="uploadHoverState"
            (click)="fileInput.click()"
            (drop)="dropFileListener($event)"
            (dragover)="dragOver($event)"
            (dragleave)="dragOver($event, false)"
          >
            <img *ngIf="user.avatar" [src]="user.avatar" />
            <div>Selecteer een afbeelding of sleep het hierheen</div>
            <input
              #fileInput
              type="file"
              accept="image/*"
              (click)="$event.stopPropagation()"
              (change)="selectFileListener($event)"
            />
            <div *ngIf="loadError$ | async as error"
              ><span class="warning">{{ error }}</span></div
            >
          </form>
        </ng-template>

        <ng-container
          *ngIf="selectedImg$ | async as selectedImg; else selectImg"
        >
          <div class="pages-settings-profile-avatar__result">
            <img *ngIf="croppedImg" [src]="croppedImg" />
            <div class="form-actions">
              <campus-button primary (click)="saveAvatar()"
                >Opslaan</campus-button
              >
            </div>
          </div>
          <div class="pages-settings-profile-avatar__cropper">
            <image-cropper
              #cropper
              [imageBase64]="selectedImg"
              [resizeToWidth]="200"
              [cropperMinWidth]="100"
              [format]="'jpeg'"
              [imageQuality]="70"
              [outputType]="'base64'"
              [roundCropper]="true"
              (imageCropped)="previewAvatar($event)"
            ></image-cropper>
            <div class="form-actions">
              <campus-button bordered (click)="resetAvatar()"
                >Andere afbeelding kiezen</campus-button
              >
            </div>
          </div>
        </ng-container>
      </div>
    </form>
  </campus-info-panel>
</div>
